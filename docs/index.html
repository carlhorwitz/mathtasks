
<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Math Tasks</title>

</head>
<body>
  <br>
  <br>
  <div class="row">
    <div class="input-field col s2 m2 offset-m1 offset-s1">
      <select id="Genre" multiple>
        <option value="None" disabled selected>Choose Course(s)</option>
        <option value="Geometry">Geometry</option>
        <option value="Dystopia">Dystopia</option>
        <option value="Fantasy">Fantasy</option>
        <option value="Graphic Novel">Graphic Novel</option>
        <option value="Historical Fiction">Historical Fiction</option>
        <option value="Horror">Horror</option>
        <option value="Humor">Humor</option>
        <option value="Literary Fiction">Literary Fiction</option>
        <option value="Mystery">Mystery</option>
        <option value="Non-Fiction">Non-Fiction</option>
        <option value="Realistic Fiction">Realistic Fiction</option>
        <option value="Poetry">Poetry</option>
        <option value="Science Fiction">Science Fiction</option>
        <option value="Short Stories">Short Stories</option>
        <option value="Thriller - Suspense">Thriller / Suspense</option>
        <option value="Young Adult">Young Adult</option>
        <option value="Other">Young Adult</option>
      </select>
      <label>Course</label>
      <button class="btn waves-effect waves-light red darken-2" onclick="genreSelector()" type="submit">Course
      </button>
    </div>

    <div class="input-field col s2 m2">
      <input placeholder="Keyword" id="Title" type="text">
      <label for="Title">Keyword</label>
      <button class="btn waves-effect waves-light red darken-2" onclick="titleSelector()" type="submit">Keyword
      </button>
    </div>
  
  
  </div>
</div>
<style>
  #wrapper {
	width: 90%;
	max-width: 2000px;
	min-width: 800px;
	margin: 50px auto;
}

#hidden {
	visibility: hidden;
}

#columns {
	-webkit-column-gap: 10px;
	-webkit-column-fill: auto;
	-moz-column-gap: 10px;
	-moz-column-fill: auto;
	column-gap: 15px;
	column-fill: auto;
}

.pin {
	display: inline-block;
	padding: 5px;
	padding-bottom: 5px;
}

@media (min-width: 400px) {
	#columns {
		-webkit-column-count: 2;
		-moz-column-count: 2;
		column-count: 2;
	}
}

@media (min-width: 960px) {
	#columns {
		-webkit-column-count: 3;
		-moz-column-count: 3;
		column-count: 3;
	}
}

@media (min-width: 1100px) {
	#columns {
		-webkit-column-count: 4;
		-moz-column-count: 4;
		column-count: 4;
	}
}

</style>
<div id="wrapper">
  <div id="columns">
  </div>
</div>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.2/css/materialize.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.2/js/materialize.min.js"></script>
</body>
</html>


<script>
$(document).ready(function() {
  $('select').material_select();
  yearSelector();
});

function genreA() {
  var genreFormula = "OR(";
  var genresSelector = document.getElementById("Genre");
  var selectedGenres = genresSelector.selectedOptions;
  var searchFront = 'SEARCH("';
  var searchBack = '", {Genre}) >= 1, '
  for (var i=0; i<selectedGenres.length;i++){
    genreFormula += searchFront + selectedGenres[i].value + searchBack;
  }
  genreFormula = genreFormula.slice(0, genreFormula.length-2);
  genreFormula += ")";
  return genreFormula;
}
function yearA() {
  var genreFormula = "OR(";
  var genresSelector = document.getElementById("year");
  var selectedGenres = genresSelector.selectedOptions;
  var searchFront = 'SEARCH("';
  var searchBack = '", {Graduation Year}) >= 1, '
  for (var i=0; i<selectedGenres.length;i++){
    genreFormula += searchFront + selectedGenres[i].value + searchBack;
  }
  genreFormula = genreFormula.slice(0, genreFormula.length-2);
  genreFormula += ")";
  return genreFormula;
}
function titleA(){
  var searchText = document.getElementById("Title").value;
  var titleFormula = 'SEARCH("'+searchText.toLowerCase()+'", {Lower Title})'
  return titleFormula;
}

function authorA(){
  var searchText = document.getElementById("Author").value;
  var authorFormula = 'SEARCH("'+searchText.toLowerCase()+'", {Name})'
  return authorFormula;
}

function multipleSelector() {
  var formula = "AND(";
  formula += yearA() + "," + genreA() + "," + titleA() + "," + authorA() + ")";
  populateBooks(formula);
}

function genreSelector() {
  var genreFormula = "OR(";
  var genresSelector = document.getElementById("Genre");
  var selectedGenres = genresSelector.selectedOptions;
  var searchFront = 'SEARCH("';
  var searchBack = '", {Course}) >= 1, '
  for (var i=0; i<selectedGenres.length;i++){
    genreFormula += searchFront + selectedGenres[i].value + searchBack;
  }
  genreFormula = genreFormula.slice(0, genreFormula.length-2);
  genreFormula += ")";
  populateBooks(genreFormula);
}
function yearSelector() {
  var genreFormula = "OR(";
  var genresSelector = document.getElementById("year");
  var selectedGenres = genresSelector.selectedOptions;
  var searchFront = 'SEARCH("';
  var searchBack = '", {Graduation Year}) >= 1, '
  for (var i=0; i<selectedGenres.length;i++){
    genreFormula += searchFront + selectedGenres[i].value + searchBack;
  }
  genreFormula = genreFormula.slice(0, genreFormula.length-2);
  genreFormula += ")";
  populateBooks(genreFormula);
}
function titleSelector(){
  var searchText = document.getElementById("Title").value;
  var titleFormula = 'SEARCH("'+searchText.toLowerCase()+'", {Search_Terms})'
  populateBooks(titleFormula);
}

function authorSelector(){
  var searchText = document.getElementById("Author").value;
  var authorFormula = 'SEARCH("'+searchText.toLowerCase()+'", {Name})'
  populateBooks(authorFormula);
}

function card(image, title, author, disc, writer){
  var row = document.createElement("div");

  var col = document.createElement("div");
  col.setAttribute("class", "pin");

  var card = document.createElement("div");
  card.setAttribute("class", "card");

  var cardImg = document.createElement("div");
  cardImg.setAttribute("class", "card-image");

  var img = document.createElement("img");
  img.src = image;
  
  var cardTitle = document.createElement("span");
  cardTitle.setAttribute("class", "card-title");
  cardTitle.innerHTML = title;


  var cardTxt = document.createElement("p");
  cardTxt.innerHTML = disc + "<br></br> - ";

  var writ = document.createElement("b");
  writ.innerHTML = writer;

  var cardCont = document.createElement("div");
  cardCont.setAttribute("class", "card-content");

  row.appendChild(col);
  col.appendChild(card);
  card.appendChild(cardImg);
  cardImg.appendChild(img);
  card.appendChild(cardCont);
  cardCont.appendChild(cardTitle);
  cardCont.appendChild(cardAuth);
  cardCont.appendChild(cardTxt);
  cardTxt.appendChild(writ);
  document.getElementById("columns").appendChild(col);
}

function populateBooks(query) {
  document.getElementById("columns").innerHTML = "";
  var request = new XMLHttpRequest();
  request.onreadystatechange = alertContents;
  var url = "https://api.airtable.com/v0/appY798jitnuEXzjT/Library?maxRecords=200&view=Grid%20view&filterByFormula=" + query
  var key = "keyxcbRWx3OOy6pco";
  request.open('GET', url);
  request.setRequestHeader('Authorization', 'Bearer ' + key)
  var response = request.send(null);
  function alertContents() {
    if (request.readyState === XMLHttpRequest.DONE) {
      if (request.status === 200) {
        var data = JSON.parse(request.responseText).records;
        for(var i = 0; i < data.length; i++) {
          description = data[i]["fields"]["Description"];
          title = data[i]["fields"]['Title'];
          src = data[i]["fields"]["Thumbnail"][0].url;
          writer = data[i]["fields"]["Source"];

          card(src, title, author, description, writer);
        }
      }
    }
  }
}
</script>
